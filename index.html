
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Twox Galaxy Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d2748 0, #020617 55%, #000 100%);
      color:#e5e7eb;
      display:flex;
      flex-direction:column;
      min-height:100vh;
    }
    header{
      padding:10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:rgba(15,23,42,0.95);
      border-bottom:1px solid #111827;
      backdrop-filter:blur(12px);
      position:sticky;
      top:0;
      z-index:10;
    }
    header .title{
      font-weight:600;
      font-size:1rem;
      display:flex;
      align-items:center;
      gap:8px;
    }
    header .title span.planet{
      width:20px;
      height:20px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%, #38bdf8, #4f46e5);
      box-shadow:0 0 12px rgba(56,189,248,0.8);
    }
    main{
      flex:1;
      display:flex;
      flex-direction:column;
      padding:10px;
      max-width:800px;
      width:100%;
      margin:0 auto;
      gap:10px;
    }
    #messages{
      flex:1;
      background:rgba(15,23,42,0.9);
      border-radius:16px;
      padding:10px;
      border:1px solid #1f2937;
      overflow-y:auto;
      box-shadow:0 8px 24px rgba(0,0,0,0.45);
    }
    .bubble{
      max-width:80%;
      margin-bottom:6px;
      padding:6px 10px;
      border-radius:16px;
      font-size:0.85rem;
      line-height:1.3;
      background:#0f172a;
      border:1px solid #1f2937;
    }
    .bubble.me{
      margin-left:auto;
      background:linear-gradient(135deg,#4f46e5,#22d3ee);
      border:none;
      color:white;
    }
    .meta{
      font-size:0.65rem;
      opacity:.7;
      margin-top:2px;
    }
    #statusBar{
      font-size:0.7rem;
      opacity:0.8;
      padding:0 4px;
    }
    #inputRow{
      display:flex;
      gap:8px;
      padding:8px 0 4px;
    }
    #msgInput{
      flex:1;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid #4b5563;
      background:#020617;
      color:#e5e7eb;
      outline:none;
      font-size:0.9rem;
    }
    #msgInput::placeholder{color:#6b7280;}
    #sendBtn{
      border:none;
      border-radius:999px;
      padding:9px 16px;
      font-size:0.9rem;
      cursor:pointer;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:white;
      display:flex;
      align-items:center;
      gap:4px;
    }
    #sendBtn:active{transform:scale(.97);}
    footer{
      font-size:0.65rem;
      text-align:center;
      padding:4px 0 8px;
      opacity:0.6;
    }
  </style>
</head>
<body>

<header>
  <div class="title">
    <span class="planet"></span>
    <span>Twox Galaxy Â· Global Chat</span>
  </div>
  <div id="statusBar">BaÄŸlanÄ±yor...</div>
</header>

<main>
  <div id="messages"></div>

  <div id="inputRow">
    <input id="msgInput" autocomplete="off" placeholder="Mesaj yaz ve Enter'a bas..." />
    <button id="sendBtn">GÃ¶nder ðŸš€</button>
  </div>
</main>

<footer>
  Twox Galaxy Â· prototype Â· Firebase Firestore + Anonymous Auth
</footer>

<script type="module">
  // Firebase SDK importlarÄ±
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, onSnapshot,
    serverTimestamp, orderBy, query
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import {
    getAuth, signInAnonymously, onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  // ðŸ”‘ Twox Galaxy Firebase config â€” BURAYI KENDÄ° KONSOLUNDAN ALDIÄžINLA AYNI TUT
  const firebaseConfig = {
    apiKey: "AIzaSyBmI2KlMUsswjf_9tWd1VJwdw5pCL0Vi5M",
    authDomain: "twox-galaxy.firebaseapp.com",
    projectId: "twox-galaxy",
    storageBucket: "twox-galaxy.firebasestorage.app",
    messagingSenderId: "1080110954694",
    appId: "1:1080110954694:web:f627f9ed46087bca557fc7",
    measurementId: "G-12XFP9K58B"
  };

  // Firebase baÅŸlat
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const statusBar = document.getElementById("statusBar");
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("msgInput");
  const sendBtn = document.getElementById("sendBtn");

  let currentUid = null;

  // Anonim login
  signInAnonymously(auth).catch((err) => {
    console.error(err);
    statusBar.textContent = "GiriÅŸ hatasÄ±: " + err.code;
  });

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUid = user.uid;
      statusBar.textContent = "BaÄŸlÄ±: " + currentUid.slice(0, 6) + "â€¦";
      startChatListener();
    } else {
      statusBar.textContent = "KullanÄ±cÄ± yok";
    }
  });

  // MesajlarÄ± canlÄ± dinle
  function startChatListener(){
    const q = query(
      collection(db, "twoxMessages"),
      orderBy("createdAt", "asc")
    );

    onSnapshot(q, (snapshot) => {
      messagesDiv.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "bubble" + (data.uid === currentUid ? " me" : "");
        const time = data.createdAt?.toDate
          ? data.createdAt.toDate().toLocaleTimeString("tr-TR", {hour:"2-digit", minute:"2-digit"})
          : "";
        div.innerHTML = `
          <div>${data.text || ""}</div>
          <div class="meta">${(data.uid || "").slice(0,6)} Â· ${time}</div>
        `;
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }, (err) => {
      console.error(err);
      statusBar.textContent = "Dinleme hatasÄ±: " + err.code;
    });
  }

  // Mesaj gÃ¶nder
  async function sendMessage(){
    const text = input.value.trim();
    if (!text || !currentUid) return;

    try{
      await addDoc(collection(db, "twoxMessages"), {
        text,
        uid: currentUid,
        createdAt: serverTimestamp()
      });
      input.value = "";
    }catch(err){
      console.error(err);
      statusBar.textContent = "GÃ¶nderim hatasÄ±: " + err.code;
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
